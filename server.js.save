import { Hono } from 'hono'
import { serve } from '@hono/node-server'
import 'dotenv/config'

// Honoã‚¢ãƒ—ãƒªï¼ˆã‚µãƒ¼ãƒãƒ¼ï¼‰ã‚’ä½œæˆ
const app = new Hono()

app.get('/health', (c) => c.json({ ok: true }))

// æœ¬æ¥ã¯DBã‹ã‚‰å–ã‚‹ãŒã€ãƒ¢ãƒƒã‚¯ç”¨ã®ãƒ‡ãƒ¼ã‚¿
const categories = [
  { id: 1, name: 'AI', slug: 'ai', created_at: '2025-08-01T00:00:00Z', updated_at: '2025-08-01T00:00:00Z' },
  { id: 2, name: 'Finance', slug: 'finance', created_at: '2025-08-01T00:00:00Z', updated_at: '2025-08-01T00:00:00Z' },
  { id: 3, name: 'Technology', slug: 'technology', created_at: '2025-08-01T00:00:00Z', updated_at: '2025-08-01T00:00:00Z' },
]

// ã€Œ/categoriesã€ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨å…¨ã‚«ãƒ†ã‚´ãƒªã‚’è¿”ã™
// total ã«ã¯ç·ä»¶æ•°ã‚’å…¥ã‚Œã¦è¿”ã™
app.get('/categories', (c) => {
  return c.json({ ok: true, items: categories, total: categories.length })
})

// =====================
// ã‚«ãƒ†ã‚´ãƒª1ä»¶å–å¾—API
// =====================
// ã€Œ/categories/:idã€ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨è©²å½“ã‚«ãƒ†ã‚´ãƒªã‚’è¿”ã™
// æ•°å€¤ã§ãªã„idã‚„å­˜åœ¨ã—ãªã„idã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™
app.get('/categories/:id', (c) => {
  const id = Number(c.req.param('id'))
  if (Number.isNaN(id)) {
    return c.json({ ok: false, error: { code: 'BAD_REQUEST', message: 'id must be a number' } }, 400)
  }
  const found = categories.find((x) => x.id === id)
  if (!found) {
    return c.json({ ok: false, error: { code: 'NOT_FOUND', message: 'category not found' } }, 404)
  }
  return c.json({ ok: true, item: found })
})

// =====================
// ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å‡¦ç†
// =====================
// ãƒãƒ¼ãƒˆ3000ç•ªã§ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•
serve({ fetch: app.fetch, port: 3000 }, (info) => {
  console.log(`ðŸš€ Hono API running at http://localhost:${info.port}`)
})

